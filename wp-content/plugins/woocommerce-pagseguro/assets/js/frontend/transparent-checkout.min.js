(function(e){"use strict";e(function(){function r(r){e("#pagseguro-credit-card-form").attr("data-credit-card-brand",r)}function a(e){return"R$ "+parseFloat(e,10).toFixed(2).replace(".",",").toString()}function t(e){var r=!0===e.interestFree?" "+wc_pagseguro_params.interest_free:"";return'<option value="'+e.quantity+'" data-installment-value="'+e.installmentAmount+'">'+e.quantity+"x "+a(e.installmentAmount)+r+"</option>"}function o(r){var a=e("#pagseguro-credit-card-form");e(".woocommerce-error",a).remove(),a.prepend('<div class="woocommerce-error" style="margin-bottom: 0.5em !important;">'+r+"</div>")}function n(){var r=e("#pagseguro-payment-methods");1===e("input[type=radio]",r).length&&r.hide()}function i(r){e(".pagseguro-method-form").hide(),e("#pagseguro-payment-methods li").removeClass("active"),e("#pagseguro-"+r+"-form").show(),e("#pagseguro-payment-method-"+r).parent("label").parent("li").addClass("active")}function s(){n(),e("#pagseguro-payment-form").show(),i(e("#pagseguro-payment-methods input[type=radio]:checked").val()),e("#pagseguro-card-holder-cpf").mask("000.000.000-00"),e("#pagseguro-card-holder-birth-date").mask("00/00/0000");var r=function(e){return 11===e.replace(/\D/g,"").length?"(00) 00000-0000":"(00) 0000-00009"},a={onKeyPress:function(e,a,t,o){t.mask(r.apply({},arguments),o)}};e("#pagseguro-card-holder-phone").mask(r,a),e("#pagseguro-bank-transfer-form input[type=radio]:checked").parent("label").parent("li").addClass("active")}function d(){if(u)return u=!1,!0;if(!e("#payment_method_pagseguro").is(":checked"))return!0;if("credit-card"!==e("body li.payment_method_pagseguro input[name=pagseguro_payment_method]:checked").val())return e("form.checkout, form#order_review").append(e('<input name="pagseguro_sender_hash" type="hidden" />').val(PagSeguroDirectPayment.getSenderHash())),!0;var r=e("form.checkout, form#order_review"),a=e("#pagseguro-credit-card-form",r),t=!1,n="",i=a.attr("data-credit-card-brand"),s=e("#pagseguro-card-number",r).val().replace(/[^\d]/g,""),d=e("#pagseguro-card-cvc",r).val(),c=e("#pagseguro-card-expiry",r).val().replace(/[^\d]/g,"").substr(0,2),g=e("#pagseguro-card-expiry",r).val().replace(/[^\d]/g,"").substr(2),p=e("#pagseguro-card-installments",r),m=new Date;return n+="<ul>","undefined"!=typeof i&&"error"!==i||(n+="<li>"+wc_pagseguro_params.invalid_card+"</li>",t=!0),2===c.length&&4===g.length||(n+="<li>"+wc_pagseguro_params.invalid_expiry+"</li>",t=!0),2===c.length&&4===g.length&&(c>12||g<=m.getFullYear()-1||g>=m.getFullYear()+20||c<m.getMonth()+2&&g.toString()===m.getFullYear().toString())&&(n+="<li>"+wc_pagseguro_params.expired_date+"</li>",t=!0),"0"===p.val()&&(n+="<li>"+wc_pagseguro_params.empty_installments+"</li>",t=!0),n+="</ul>",t?o(n):PagSeguroDirectPayment.createCardToken({brand:i,cardNumber:s,cvv:d,expirationMonth:c,expirationYear:g,success:function(a){e("input[name=pagseguro_credit_card_hash], input[name=pagseguro_credit_card_hash], input[name=pagseguro_installment_value]",r).remove(),r.append(e('<input name="pagseguro_credit_card_hash" type="hidden" />').val(a.card.token)),r.append(e('<input name="pagseguro_sender_hash" type="hidden" />').val(PagSeguroDirectPayment.getSenderHash())),r.append(e('<input name="pagseguro_installment_value" type="hidden" />').val(e("option:selected",p).attr("data-installment-value"))),u=!0,r.submit()},error:function(){o(wc_pagseguro_params.general_error)}}),!1}var u=!1;wc_pagseguro_params.session_id?(PagSeguroDirectPayment.setSessionId(wc_pagseguro_params.session_id),"1"===wc_checkout_params.is_checkout?e("body").on("updated_checkout",function(){s()}):s(),e("body").on("click","#pagseguro-bank-transfer-form input[type=radio]",function(){e("#pagseguro-bank-transfer-form li").removeClass("active"),e(this).parent("label").parent("li").addClass("active")}),e("body").on("click","#pagseguro-payment-methods input[type=radio]",function(){i(e(this).val())}),e("body").on("focusout","#pagseguro-card-number",function(){var a=e(this).val().replace(/[^\d]/g,"").substr(0,6),t=e("body #pagseguro-card-installments");6===a.length&&(t.empty(),t.attr("disabled","disabled"),PagSeguroDirectPayment.getBrand({cardBin:a,success:function(a){e("body").trigger("pagseguro_credit_card_brand",a.brand.name),r(a.brand.name)},error:function(){e("body").trigger("pagseguro_credit_card_brand","error"),r("error")}}))}),e("body").on("updated_checkout",function(){var r=e("body #pagseguro-card-number");0<r.length&&r.focusout()}),e("body").on("focus","#pagseguro-card-number, #pagseguro-card-expiry",function(){e("#pagseguro-credit-card-form .woocommerce-error").remove()}),e("body").on("pagseguro_credit_card_brand",function(r,a){"error"!==a?PagSeguroDirectPayment.getInstallments({amount:e("body #pagseguro-payment-form").data("cart_total"),brand:a,success:function(r){var n=e("body #pagseguro-card-installments");!1===r.error?(n.empty(),n.removeAttr("disabled"),n.append('<option value="0">--</option>'),e.each(r.installments[a],function(e,r){0==e&&n.append(t(r))})):o(wc_pagseguro_params.invalid_card)},error:function(){o(wc_pagseguro_params.invalid_card)}}):o(wc_pagseguro_params.invalid_card)}),e("form.checkout").on("checkout_place_order_pagseguro",function(){return d()}),e("form#order_review").submit(function(){return d()})):e("body").on("updated_checkout",function(){e("#pagseguro-payment-form").remove()})})})(jQuery);